# Progress

## 2025-11-17 時点の進捗

- Step1 要件（GAME_DESIGN.md 10.開発計画）のうち、神父NPC追加(9.7)、セーブ/ロード機能(9.1)、死亡ペナルティ(9.2)、UI調整(9.14)を実装済み。
  - 街の教会に神父を配置し、指定スプライト/座標で描画。会話から教会オーバーレイを開き、祈りで記録できる。
  - `save_system.js`を新規作成し、プレイヤー状態・進行フラグ・位置・宝箱状態などをlocalStorageへ保存/読込。「続きから」ボタンも追加した。
  - 戦闘敗北/飢餓による気絶時、神父前へ復活しGold/Food半減・HP全快にリセット。復活メッセージも仕様に合わせて更新。
  - 教会オーバーレイやタイトルメニューを宿屋/ショップ同等のサイズ感で統一し、Y/Nや矢印で操作できるように整理。
  - 宝箱取得メッセージの文字化けを修正し、「宝箱を開けた！ Ancient Key を手に入れた。」と表示されるようにした。

## 2025-11-20 時点の進捗

- Step2: 装備・経済バランスの先行整備（完了）
  - `constants.js` に木/銅/鉄/聖の剣・盾、力のハンマー/聖鉱石など新アイテムIDを追加
  - `data/items.js` をメタデータ駆動に刷新し、カテゴリ・価格・装備ボーナス・消費効果を一元管理
  - `state/player_state.js` の購入/売却/使用/装備ロジックをメタデータ参照型へリファクタリングし、装備ボーナスを汎用処理化
  - `shop.js` に木/銅/鉄の剣と盾を販売リストとして追加し、UI表示もメタデータベースに変更
  - `renderer/ui_panel.js` を更新し、ステータスパネルで現在装備している武器/盾の名称がインベントリに合わせて表示されるようにした
  - **装備バランス調整**（コミット52df2c4）:
    - 木の剣: ATK +1→+2、価格 20→35 Gold
    - 銅の剣: ATK +2→+4、価格 40→60 Gold
    - 鉄の剣: 価格 80→100 Gold
    - 木の盾: 価格 35→30 Gold
    - 鉄の盾: 価格 70→90 Gold
  - **戦闘報酬システム追加**（コミット4ccb6bb）:
    - モンスター撃破時、1/2の確率でFood+10をドロップする機能を実装
    - `combat.js` の `handleVictory()` 関数に追加
  - **モンスタースポーンロジック調整**（コミットa9642a2）:
    - フィールドモンスター数: 最小 3→4、最大 5→6
    - 洞窟モンスター数: 最小 2→4、最大 4→6
    - リスポーン間隔: 20ステップ → 15ステップ
    - `entities/entity_types.js` の `enemyRules` を更新
  - **レベルアップシステムの改修**（コミットc48b960）:
    - レベルアップに必要な経験値を配列定義から計算式ベースに変更
    - 計算式: レベル n に必要な経験値 = 5 × n × (n - 1)
    - 最大レベルを99に設定（LV99到達に必要な経験値: 48,510）
    - `constants.js` に `getExpForLevel()` 関数を実装
    - `state/player_state.js` の `grantExp()` 関数で最大レベルチェックを追加
    - レベルアップ時の成長: MaxHP +5、偶数レベルでATK +1、奇数レベルでDEF +1
