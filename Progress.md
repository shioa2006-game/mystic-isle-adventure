# Progress

## 2025-11-17 時点の進捗
- Step1: GAME_DESIGN.md 10.開発計画のうち、神父NPC追加(9.7)、セーブ/ロード機能(9.1)、死亡ペナルティ(9.2)、UI調整(9.14)を実装
  - 街の教会に神父を配置し、会話から教会オーバーレイを開いて祈りで記録できるようにした
  - `save_system.js` を新規作成し、プレイヤー状態・進行フラグ・位置・宝箱状態などを localStorage に保存/読み込み。「続きから」ボタンも追加
  - 戦闘敗北や飢餓による気絶時、神父前へ復活し Gold/Food 半減・HP 全快にリセット。復活メッセージも仕様に合わせて更新
  - 教会オーバーレイやタイトルメニューを宿屋/ショップと同等サイズに整え、Y/N 表記や矢印で操作できるように統一
  - 宝箱取得メッセージの文字化けを修正し、「宝箱を開けた！ Ancient Key を手に入れた。」と表示されるようにした

## 2025-11-20 時点の進捗
- Step2: 装備・経済バランスの先行整備（完了）
  - `constants.js` に木/銅/鉄/聖の剣・盾、力のハンマー/聖鉱石など新アイテムIDを追加
  - `data/items.js` をメタデータ駆動に刷新し、カテゴリ・価格・装備ボーナス・消費効果を一元管理
  - `state/player_state.js` をメタデータ参照型へリファクタリングし、購入/売却/使用/装備処理を共通化
  - `shop.js` に木/銅/鉄の武器・盾を販売リストとして追加し、UI表示もメタデータベースに変更
  - `renderer/ui_panel.js` でステータスパネルに現在装備中の武器/盾名称を表示
  - **装備バランス調整（コミット 52df2c4）**
    - 木の剣: ATK +1 → +2、価格 20 → 35 Gold
    - 銅の剣: ATK +2 → +4、価格 40 → 60 Gold
    - 鉄の剣: 価格 80 → 100 Gold
    - 木の盾: 価格 35 → 30 Gold
    - 鉄の盾: 価格 70 → 90 Gold
  - **戦闘報酬システム追加（コミット 4ccb6bb）**: モンスター撃破時、1/2の確率で Food+10 をドロップ (`combat.js`の`handleVictory()` を更新)
  - **モンスタースポーン調整（コミット a9642a2）**: フィールド最小3→4・最大5→6、洞窟最小2→4・最大4→6、リスポーン間隔 20→15 ステップ (`entities/entity_types.js` の `enemyRules` を更新)
  - **レベルアップ改修（コミット c48b960）**: レベル n 必要経験値 = 5×n×(n−1)、最大レベル 99 (`constants.js` に `getExpForLevel()` 追加)。`state/player_state.js` で最大レベルチェックと成長処理（MaxHP+5、偶数レベルでATK+1、奇数レベルでDEF+1）を実装

## 2025-11-21 時点の進捗
- Step3: 鍛冶屋救出〜力のハンマー授与までのストーリー骨格を実装し、洞窟B2イベントをテスト可能にした
  - `state/player_state.js` / `game_state.js` / `save_system.js` に鍛冶屋・聖剣・聖盾用のフラグを追加し、セーブ/ロードでも進行状況を保持
  - 洞窟B2の鍛冶屋護衛ヴァンパイアを固定スポーン化し、`guardianKey` を使った討伐判定で移動後に倒しても進行するよう修正
  - `dialogue.js` / `assets/dialogues.json` に王様・鍛冶屋のフェーズ別会話とイベントトリガーを追加し、ハンマー授与〜聖剣錬成〜聖盾授与の導線を構築
  - ステータスUIの Key 表示を `Story: Power Hammer / Holy Ore / -` に変更し、イベントアイテムの所持状況を可視化
  - 遺跡タイルガードや洞窟宝箱削除など新ストーリー仕様への移行準備を実施し、洞窟2/遺跡実装に備えた
