# 追加開発と現行コードの差分メモ

- セリフ/メッセージの文字化け・内容差異
  - `dialogue.js` / `assets/dialogues.json` の王様/鍛冶屋/神父セリフが設計書の日本語と一致しておらず、文字化けも残っている。設計書記載のセリフに差し替えが必要。

---

## NPCダイアログ・ストーリーフロー統合表

### フェーズ別・NPC統合マトリックス表

| 項目 | フェーズ0<br>**START** | フェーズ1<br>**BLACKSMITH_RESCUED** | フェーズ2<br>**ORE_OBTAINED** | フェーズ3<br>**HOLY_SWORD_CREATED** | フェーズ4<br>**DRAGON_DEFEATED** |
|:---|:---|:---|:---|:---|:---|
| **到達条件（フラグ）** | ゲーム開始時 | `blacksmithRescued=true` | `hasOre=true` | `holySwordCreated=true` | `dragonDefeated=true` |
| **王様のセリフ** | 「よく来た、若き冒険者よ...竜が現れた...鍛冶屋が行方不明」 | 「鍛冶屋を助けてくれたそうだな...聖鉱石が欠かせぬ」 | 「聖鉱石を見つけたのだな...早く鍛冶屋に届け」 | 「おお、見事な聖剣だ！...約束通り、聖盾を授けよう」 | 「竜を倒し、島を救ってくれて感謝するぞ！」 |
| **鍛冶屋のセリフ** | 「助けてくれて本当に感謝する！...聖鉱石はここにはなかった」 | 「命の恩人だ。礼に力のハンマーを渡そう...東の海岸に岩で塞がれた洞窟...」 | 「おお、これこそ聖鉱石だ！...**聖剣を鍛えるには鉄の剣も必要だ**」 | 「聖盾は王様に頼んで受け取ってくれ。」 | （セリフ定義なし） |
| **神父のセリフ** | 「ようこそ、旅の冒険者よ...ここで祈れば旅路を記録できる」 | （フェーズ0と同じ） | （フェーズ0と同じ） | （フェーズ0と同じ） | （フェーズ0と同じ） |
| **会話後イベント** | **王**: `questTalked=true`, `questGiven=true`<br>**鍛**: `finalizeBlacksmithRescue()` | **鍛**: `tryGivePowerHammer()` | **鍛**: `tryForgeHolySword()` | **王**: `tryGrantHolyShield()` | - |
| **必要アイテム** | - | インベントリ空き1枠 | **鉄の剣** + 聖鉱石 | インベントリ空き1枠 | - |
| **成功時メッセージ** | **鍛**: 「鍛冶屋は無事に街へ戻っていった。」 | 「Power Hammer を受け取った。」 | 「鍛冶屋が聖剣を鍛え上げた！」 | 「聖盾を授かった！」 | - |
| **失敗時メッセージ** | - | 「インベントリの空きが必要だ。」 | **「鉄の剣を持っていないため、鍛冶が始められない。」**<br>または<br>「聖鉱石を所持していない。」 | 「インベントリの整理が必要だ。」 | - |
| **獲得アイテム** | - | **力のハンマー** | **聖剣**<br>（鉄の剣と聖鉱石を消費） | **聖盾** | - |
